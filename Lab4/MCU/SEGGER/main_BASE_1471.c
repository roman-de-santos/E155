// main.c
// Fur Elise, E155 Lab 4
// Updated Fall 2024

#include "STM32L432KC_FLASH.h"

#include "STM32L432KC_GPIO.h"

#include "STM32L432KC_RCC.h"

#include "STM32L432KC_TIM.h"

#include "stdint.h"

#include <stdio.h>

int mario[][2] = {
  {660,100}, {660,100}, {0,100}, {660,100}, 
  {0,150}, {523,100}, {660,100}, {0,150}, {784,100}, 
  {0,300}, {392,100}, {0,300}, 

  {523,100}, {0,250}, {392,100}, {0,250}, {330,100}, 
  {0,250}, {440,100}, {494,100}, {466,100}, {440,100}, 
  {392,100}, {660,100}, {784,100}, {880,100}, {698,100}, {784,100}, 
  {660,100}, {523,100}, {587,100}, {494,100}, {0,300}, 

  // second phrase
  {523,100}, {0,150}, {392,100}, {0,150}, {330,100}, 
  {0,150}, {440,100}, {494,100}, {466,100}, {440,100}, 
  {392,100}, {660,100}, {784,100}, {880,100}, 
  {698,100}, {784,100}, {660,100}, {523,100}, {587,100}, {494,100}, 
  {0,300}, 

  // rising sequence
  {784,100}, {740,100}, {698,100}, {622,100}, {659,100}, 
  {415,100}, {440,100}, {523,100}, {0,200}, {440,100}, {523,100}, 
  {587,100}, {0,150}, {494,100}, {523,100}, {440,100}, {0,200}, 

  {784,100}, {740,100}, {698,100}, {622,100}, {659,100}, 
  {415,100}, {440,100}, {523,100}, {0,200}, {440,100}, {523,100}, 
  {587,100}, {0,150}, {494,100}, {523,100}, {440,100}, {0,300}
};





// Pitch in Hz, duration in ms
const int notes[][2] = {
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	250},
{  0,	125},
{494,	125},
{523,	125},
{587,	125},
{659,	375},
{392,	125},
{699,	125},
{659,	125},
{587,	375},
{349,	125},
{659,	125},
{587,	125},
{523,	375},
{330,	125},
{587,	125},
{523,	125},
{494,	250},
{  0,	125},
{330,	125},
{659,	125},
{  0,	250},
{659,	125},
{1319,	125},
{  0,	250},
{623,	125},
{659,	125},
{  0,	250},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{416,	125},
{494,	125},
{523,	250},
{  0,	125},
{330,	125},
{659,	125},
{623,	125},
{659,	125},
{623,	125},
{659,	125},
{494,	125},
{587,	125},
{523,	125},
{440,	250},
{  0,	125},
{262,	125},
{330,	125},
{440,	125},
{494,	250},
{  0,	125},
{330,	125},
{523,	125},
{494,	125},
{440,	500},
{  0,	0}};

void song(const int songArray[][2]){
    int i = 0;

    while (!((songArray[i][1]==0)&(songArray[i][0]==0))){
        setTIM16_freq(songArray[i][0]);                 // turn on PWM at given frequency "freq"
        DelayTIM15(songArray[i][1]);          // leave the note on for time "milliseconds"
        i++;
    }
    setTIM16_freq(0);                  // turn off PWM and TIM2 by passing in freq=0
}

void testDelay(){
  while(1){
    
    printf("Hello, World!");
    DelayTIM15(1000);
  }
}


int main(void) {


    configureFlash();
    configureClock();
    initTIM15();
    initTIM16();
    PA6OutputPWM();

    song(notes);

    //song(mario);
	
}





